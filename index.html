<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Bir İşlem</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f8ff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      min-height: 100vh;
      transition: background-color 0.5s;
    }
    .kapsayici {
      background-color: white;
      margin-top: 20px;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      width: 95%;
      max-width: 1440px;
      text-align: center;
    }
    .footer {
      text-align: center;
      margin: 20px 0;
      font-size: 14px;
      color: #555;
      font-style: italic;
    }
    textarea, input[type="text"], select {
      padding: 6px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    textarea { width: 100%; height: 100px; resize: none; }
    label { font-size: 16px; }
    .hidden { display: none; }

    .btn {
      padding: 8px 14px;
      font-size: 14px;
      margin: 5px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
    }

    .ogrenci-listesi {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 25px;
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
    }
    .ogrenci {
      width: 70px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      background-color: #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: 0.3s;
    }
    .ogrenci:hover { transform: scale(1.05); }
    .puan-verildi {
      background-color: #81c784 !important;
      color: white;
      font-weight: bold;
    }

    #sayilarAlani, #hedefSayi { font-size: 30px; margin: 15px 0; }
    .box {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 2.5em;       /* font-size’a bağlı genişlik */
  height: 2.5em;      /* font-size’a bağlı yükseklik */
  font-size: 20px;    /* yazı boyutu → değiştirerek büyütebilirsin */
  font-weight: bold;
  background-color: #3498db;
  color: #fff;
  border-radius: 8px;
  margin: 4px;
}
    #cozumAlani {
      margin-top: 15px;
      display: flex; flex-direction: column; gap: 8px; align-items: center;
    }
    .step-box {
      background-color: #e1f5fe; padding: 6px 10px; border-radius: 6px;
      box-shadow: 0 0 4px rgba(0,0,0,0.2); font-weight: bold; width: fit-content; min-width: 150px;
    }

    .ilk-uc-wrapper {
      display: flex; justify-content: center; gap: 10px; margin: 10px 0; flex-wrap: wrap;
    }
    .ilk-uc-kutu {
      background-color: #fff9c4; border: 2px solid #ccc; border-radius: 12px;
      padding: 10px; min-width: 120px; box-shadow: 0 0 5px rgba(0,0,0,0.1);
      text-align: center; font-weight: bold;
    }
    .ilk-1 { background-color: #ffe082; }
    .ilk-2 { background-color: #e0e0e0; }
    .ilk-3 { background-color: #d7ccc8; }

    .modal {
      position: fixed; inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none; justify-content: center; align-items: center;
      z-index: 999;
    }
    .modal .modal-content {
      background: #fff; padding: 20px; border-radius: 10px; text-align: center;
      width: 600px; max-height: 90vh; overflow-y: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .modal input { width: 60%; padding: 8px; margin: 10px 0; }

    table {
      width: 100%; border-collapse: collapse; margin-top: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    th, td { border: 1px solid #ccc; padding: 6px 10px; font-size: 14px; text-align: center; }
  </style>
</head>
<body>
  <div class="kapsayici">
    <div id="girisEkrani">
      <h3>📝 Öğrenci Adlarını Girin 📝</h3>
      <textarea id="ogrenciTextarea" placeholder="Öğrenci isimlerini her satıra bir tane olacak şekilde yazınız."></textarea><br>
      <button class="btn" onclick="basla()">🏁 BAŞLA 🏁</button>
    </div>

    <div id="oyunEkrani" class="hidden">
      <h2>🧮 Bir İşlem 🧮</h2>

      <label>Seviye:
        <select id="seviyeSec">
          <option value="1">1 (En Kolay)</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option>
          <option value="5">5</option><option value="6">6</option>
          <option value="7">7</option><option value="8">8</option>
          <option value="9">9</option><option value="10">10 (En Zor)</option>
        </select>
      </label>

      <div id="sayilarAlani"></div>
      <div id="hedefSayi"></div>
      <button class="btn" onclick="uretimYap()">🔢 Sayıları Üret 🔢</button>
      <button class="btn" onclick="gosterCozum()">🧠 Çözümü Göster 🧠</button>
      <button class="btn" onclick="puanTablosuAc()">🥇🥈🥉 Puan Tablosu 🥉🥈🥇</button>

      <!-- Çözümler burada -->
      <div id="cozumAlani"></div>

      <!-- Öğrenciler bunun altında -->
      <div class="ogrenci-listesi" id="ogrenciler"></div>
    </div>
  </div>

  <div class="footer">made by İSMAİL AKÇELİK</div>

  <!-- Puan Tablosu Modal -->
  <div id="puanTabloModal" class="modal">
    <div class="modal-content">
      <h4>🥇🥈🥉 Puan Tablosu 🥉🥈🥇</h4>
      <div class="ilk-uc-wrapper" id="ilkUc"></div>
      <table>
        <thead><tr><th>İsim</th><th>Puan</th></tr></thead>
        <tbody id="puanTabloGovde"></tbody>
      </table>
      <br>
      <button class="btn" onclick="puanTablosuKapat()">Kapat</button>
    </div>
  </div>

  <!-- Puan Modal -->
  <div id="puanModal" class="modal">
    <div class="modal-content">
      <h3 id="puanModalBaslik"></h3>
      <input type="number" id="puanInput" placeholder="Puan girin" />
      <br>
      <button class="btn" onclick="puanGir()">Kaydet</button>
      <button class="btn" onclick="modalKapat()">İptal</button>
    </div>
  </div>

  <!-- Uyarı Modal -->
  <div id="uyariModal" class="modal">
    <div class="modal-content">
      <p id="uyariMesaj" style="margin-bottom:20px; font-weight:bold;"></p>
      <button class="btn" onclick="uyariKapat()">Tamam</button>
    </div>
  </div>

  <!-- Geri Al Modal -->
  <div id="geriAlModal" class="modal">
    <div class="modal-content">
      <p style="margin-bottom:20px; font-weight:bold;">Bu turda verilen puanı geri almak üzeresiniz.</p>
      <button class="btn" onclick="puanGeriAl()">Onayla</button>
      <button class="btn" onclick="geriAlKapat()">İptal</button>
    </div>
  </div>

<script>
let ogrenciler = [];
let puanlar = {};
let aktifSayilar = [];
let hedef = 0;
let cozumAdimlari = [];
let seciliOgrenci = null;
let aktifIslemler = [];
let erkenBitir = false;
let sonVerilenPuan = {};

const renkler = ["#f0f8ff","#e8f5e9","#fffde7","#fce4ec","#f3e5f5","#ede7f6","#e0f7fa","#f1f8e9","#fbe9e7"];

function uyariGoster(mesaj) {
  document.getElementById("uyariMesaj").innerText = mesaj;
  document.getElementById("uyariModal").style.display = "flex";
}
function uyariKapat() {
  document.getElementById("uyariModal").style.display = "none";
}
function modalKapat() {
  document.getElementById("puanModal").style.display = "none";
}
function geriAlKapat() {
  document.getElementById("geriAlModal").style.display = "none";
}

function basla() {
  const metin = document.getElementById("ogrenciTextarea").value.trim();
  if (!metin) {
    uyariGoster("Lütfen önce öğrenci isimlerini yazınız.");
    return;
  }
  ogrenciler = metin.split("\n").map(i => i.trim()).filter(i => i);
  puanlar = {};
  sonVerilenPuan = {};
  document.getElementById("girisEkrani").classList.add("hidden");
  document.getElementById("oyunEkrani").classList.remove("hidden");
  const ogrenciAlani = document.getElementById("ogrenciler");
  ogrenciAlani.innerHTML = "";
  ogrenciler.forEach(isim => {
    puanlar[isim] = 0;
    sonVerilenPuan[isim] = 0;
    const div = document.createElement("div");
    div.className = "ogrenci";
    div.textContent = isim;
    div.onclick = function () {
      if (div.classList.contains("puan-verildi")) {
        seciliOgrenci = isim;
        document.getElementById("geriAlModal").style.display = "flex";
      } else {
        seciliOgrenci = isim;
        document.getElementById("puanModalBaslik").innerText = `${isim} için puan gir:`;
        document.getElementById("puanInput").value = "";
        document.getElementById("puanModal").style.display = "flex";
        setTimeout(() => document.getElementById("puanInput").focus(), 100);
      }
    };
    ogrenciAlani.appendChild(div);
  });
  guncellePuanTablosu();
}

function puanGir() {
  const deger = parseInt(document.getElementById("puanInput").value);
  if (!isNaN(deger)) {
    puanlar[seciliOgrenci] += deger;
    sonVerilenPuan[seciliOgrenci] = deger;
    const ogrenciKutusu = [...document.getElementsByClassName("ogrenci")]
      .find(div => div.textContent === seciliOgrenci);
    if (ogrenciKutusu) ogrenciKutusu.classList.add("puan-verildi");
    guncellePuanTablosu();
  }
  modalKapat();
}

function puanGeriAl() {
  if (seciliOgrenci && sonVerilenPuan[seciliOgrenci] > 0) {
    puanlar[seciliOgrenci] = Math.max(0, puanlar[seciliOgrenci] - sonVerilenPuan[seciliOgrenci]);
    sonVerilenPuan[seciliOgrenci] = 0;
    const ogrenciKutusu = [...document.getElementsByClassName("ogrenci")]
      .find(div => div.textContent === seciliOgrenci);
    if (ogrenciKutusu) ogrenciKutusu.classList.remove("puan-verildi");
    guncellePuanTablosu();
  }
  geriAlKapat();
}

document.addEventListener("keydown", function(e) {
  if (document.getElementById("puanModal").style.display === "flex") {
    if (e.key === "Enter") puanGir();
    if (e.key === "Escape") modalKapat();
  }
  if (document.getElementById("uyariModal").style.display === "flex") {
    if (e.key === "Enter" || e.key === "Escape") uyariKapat();
  }
  if (document.getElementById("geriAlModal").style.display === "flex") {
    if (e.key === "Enter") puanGeriAl();
    if (e.key === "Escape") geriAlKapat();
  }
});

function uretimYap() {
  document.querySelectorAll(".ogrenci").forEach(div => div.classList.remove("puan-verildi"));
  const seviye = parseInt(document.getElementById("seviyeSec").value);
  if (seviye <= 2) aktifIslemler = ['+','-'];
  else if (seviye <= 6) aktifIslemler = ['+','-','*'];
  else aktifIslemler = ['+','-','*','/'];
  erkenBitir = (seviye <= 5);
  let cozum = null;
  while (!cozum) {
    const sayilar = [];
    let ikiBasamakli = 0;
    for (let i = 0; i < 5; i++) {
      let s;
      if (ikiBasamakli < 2 && Math.random() < 0.3) {
        s = Math.floor(Math.random() * 90) + 10;
        ikiBasamakli++;
      } else {
        s = Math.floor(Math.random() * 9) + 1;
      }
      sayilar.push(s);
    }
    if (seviye <= 2) {
      const [a, b] = sayilar.slice(0, 2);
      if (Math.random() < 0.5) {
        hedef = a + b;
        cozumAdimlari = [`${a} + ${b} = ${hedef}`];
      } else {
        const big = Math.max(a, b), small = Math.min(a, b);
        hedef = big - small;
        cozumAdimlari = [`${big} - ${small} = ${hedef}`];
      }
      cozum = true;
    } else if (seviye <= 6) {
      hedef = sayilar.slice(0,3).reduce((x,y)=>x+y);
    } else {
      hedef = (seviye <= 6) ? Math.floor(Math.random() * 401) + 100
                            : Math.floor(Math.random() * 500) + 500;
    }
    aktifSayilar = sayilar;
    if (seviye > 2) {
      cozumAdimlari = [];
      const perm = permute(sayilar);
      for (let p of perm) {
        const sonuc = hesapla(p, 0, p[0], `${p[0]}`, seviye);
        if (sonuc) {
          cozum = sonuc;
          break;
        }
      }
    }
  }
  document.getElementById("sayilarAlani").innerHTML =
    "Verilen Sayılar: " + aktifSayilar.map(s => `<span class='box'>${s}</span>`).join('');
  document.getElementById("hedefSayi").innerHTML = `🎯 Hedef: <strong>${hedef}</strong>`;
  document.getElementById("cozumAlani").innerHTML = "";
  document.body.style.backgroundColor = renkler[Math.floor(Math.random()*renkler.length)];
}

function gosterCozum() {
  if (aktifSayilar.length === 0) {
    uyariGoster("Lütfen önce sayıları üretiniz.");
    return;
  }
  const cozumAlani = document.getElementById("cozumAlani");
  cozumAlani.innerHTML = cozumAdimlari
    .map(adim => `<div class="step-box">${adim}</div>`).join('');
}

function hesapla(sayilar, i, toplam, yol, seviye) {
  if (erkenBitir && toplam === hedef) return yol;
  if (i === sayilar.length - 1) {
    if (toplam === hedef) return yol;
    return null;
  }
  for (let op of aktifIslemler) {
    let yeniToplam;
    if (op === '/' && toplam % sayilar[i+1] !== 0) continue;
    yeniToplam = eval(`${toplam}${op}${sayilar[i+1]}`);
    const gosterOp = op === '*' ? 'x' : op === '/' ? '÷' : op;
    const adim = `${toplam} ${gosterOp} ${sayilar[i+1]} = ${yeniToplam}`;
    cozumAdimlari.push(adim);
    const sonuc = hesapla(sayilar, i+1, yeniToplam, yol, seviye);
    if (sonuc) return sonuc;
    cozumAdimlari.pop();
  }
  return null;
}

function permute(arr) {
  if (arr.length <= 1) return [arr];
  let result = [];
  for (let i = 0; i < arr.length; i++) {
    const rest = [...arr.slice(0, i), ...arr.slice(i + 1)];
    const perms = permute(rest);
    for (let perm of perms) {
      result.push([arr[i], ...perm]);
    }
  }
  return result;
}

function guncellePuanTablosu() {
  const govde = document.getElementById("puanTabloGovde");
  const ilkUcDiv = document.getElementById("ilkUc");
  govde.innerHTML = "";
  ilkUcDiv.innerHTML = "";
  const sirali = Object.entries(puanlar).sort((a, b) => b[1] - a[1]);
  if (sirali.length === 0) return;
  const uniqueScores = [...new Set(sirali.map(e => e[1]))];
  const ilkUcPuanlar = uniqueScores.slice(0, 3);
  ilkUcPuanlar.forEach((puan, index) => {
    const div = document.createElement("div");
    div.className = `ilk-uc-kutu ilk-${index + 1}`;
    const madalya = ["🥇", "🥈", "🥉"][index] || "";
    const isimler = sirali.filter(e => e[1] === puan).map(e => e[0]);
    div.innerHTML = `${madalya}<br>${isimler.join("<br>")}<br><span style='font-size:13px;'>${puan} puan</span>`;
    ilkUcDiv.appendChild(div);
  });
  sirali.forEach(([isim, puan]) => {
    if (!ilkUcPuanlar.includes(puan)) {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${isim}</td><td>${puan}</td>`;
      govde.appendChild(tr);
    }
  });
}

function puanTablosuAc() {
  document.getElementById("puanTabloModal").style.display = "flex";
}
function puanTablosuKapat() {
  document.getElementById("puanTabloModal").style.display = "none";
}

// dışarı tıklayınca modal kapanır
window.addEventListener("click", function(e) {
  const modal = document.getElementById("puanTabloModal");
  if (e.target === modal) {
    puanTablosuKapat();
  }
});
</script>
</body>
</html>
