<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Bir İşlem</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f8ff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      min-height: 100vh;
      transition: background-color 0.5s;
    }
    .kapsayici {
      background-color: white;
      margin-top: 20px;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      width: 95%;
      max-width: 1440px;
      text-align: center;
    }
    .footer {
      text-align: center;
      margin: 20px 0;
      font-size: 14px;
      color: #555;
      font-style: italic;
    }
    textarea, input[type="text"], select {
      padding: 6px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    textarea { width: 100%; height: 100px; resize: none; }
    label { font-size: 16px; }
    .hidden { display: none; }

    .btn {
      padding: 8px 14px;
      font-size: 14px;
      margin: 5px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
    }

    .ogrenci-listesi {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 25px;
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
    }
    .ogrenci {
      width: 70px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px;
      background-color: #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: 0.3s;
    }
    .ogrenci:hover { transform: scale(1.05); }
    .puan-verildi {
      background-color: #81c784 !important;
      color: white;
      font-weight: bold;
    }

    /* Başlık + içerik iki sütun */
    .sayilar-ve-hedef {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 80px;
      margin: 10px 0 20px;
      flex-wrap: wrap;
    }
    .sutun { display: flex; flex-direction: column; align-items: center; }

    .sutun-baslik {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 8px;
     
    }
    #sayilarBaslik { color: #2c3e50; }
    #hedefBaslik { color: #c0392b; }

    /* Bu font-size ebeveynden gelsin -> kutular 2.5em'e göre ölçeklensin */
    #sayilarAlani, #hedefSayi { font-size: 50px; margin: 15px 0; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }

    .box, .hedef-box {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.9em;   /* ebeveyn font-size’a bağlı */
      height: 1.9em;  /* ebeveyn font-size’a bağlı */
      /* font-size: inherit; -> default zaten inherit, ayarlamaya gerek yok */
      font-weight: bold;
      color: #fff;
      border-radius: 8px;
      margin: 4px;
    }
    .box { background-color: #3498db; }
    .hedef-box { background-color: #e74c3c; }

    #cozumAlani {
      margin-top: 15px;
      display: flex; flex-direction: column; gap: 8px; align-items: center;
    }
    .step-box {
      background-color: #e1f5fe; padding: 6px 10px; border-radius: 6px;
      box-shadow: 0 0 4px rgba(0,0,0,0.2); font-weight: bold; width: fit-content; min-width: 150px;
    }

    .ilk-uc-wrapper {
      display: flex; justify-content: center; gap: 10px; margin: 10px 0; flex-wrap: wrap;
    }
    .ilk-uc-kutu {
      background-color: #fff9c4; border: 2px solid #ccc; border-radius: 12px;
      padding: 10px; min-width: 120px; box-shadow: 0 0 5px rgba(0,0,0,0.1);
      text-align: center; font-weight: bold;
    }
    .ilk-1 { background-color: #ffe082; }
    .ilk-2 { background-color: #e0e0e0; }
    .ilk-3 { background-color: #d7ccc8; }

    .modal {
      position: fixed; inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none; justify-content: center; align-items: center;
      z-index: 999;
    }
    .modal .modal-content {
      background: #fff; padding: 20px; border-radius: 10px; text-align: center;
      width: 600px; max-height: 90vh; overflow-y: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    .modal input { width: 60%; padding: 8px; margin: 10px 0; }

    table {
      width: 100%; border-collapse: collapse; margin-top: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    th, td { border: 1px solid #ccc; padding: 6px 10px; font-size: 14px; text-align: center; }
 #timerContainer {
  position: fixed;
  top: 30px;
  right: 20px;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 6px;
  z-index: 1000;
}

#timeButtons {
  display: flex;
  gap: 6px;
}

.time-btn {
  background: #eee;
  border: 1px solid #aaa;
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  transition: 0.2s;
}
.time-btn:hover {
  background: #ddd;
}
.time-btn.active {
  background: #4CAF50;
  color: white;
  border-color: #388E3C;
}

#timer {
  background: rgba(0,0,0,0.7);
  color: #fff;
  font-size: 20px;
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: bold;
  min-width: 110px;
  text-align: center;
}
#timer.timeout {
  background: #c62828;
}
 
 </style>
</head>
<body>
  <div class="kapsayici">
    <div id="girisEkrani">
      <h3>📝 Katılımcı İsimlerini Girin 📝</h3>
      <textarea id="ogrenciTextarea" placeholder="Katılımcı isimlerini her satıra bir tane olacak şekilde yazınız."></textarea><br>
      <button class="btn" onclick="basla()">🏁 BAŞLA 🏁</button>
    </div>

    <div id="oyunEkrani" class="hidden">
      <h2>🧮 Bir İşlem 🧮</h2>
      <!-- Sağ üst köşe: süre seçimi + geri sayım -->
<div id="timerContainer">
  <div id="timeButtons">
    <div class="time-btn" onclick="setTimer(1)">1</div>
    <div class="time-btn" onclick="setTimer(3)">3</div>
    <div class="time-btn" onclick="setTimer(5)">5</div>
    <div class="time-btn" onclick="setTimer(10)">10</div>
  </div>
  <div id="timer">⏱ 00:00</div>
</div>

      <label>Seviye:
        <select id="seviyeSec">
          <option value="1">1 (En Kolay)</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option>
          <option value="5">5</option><option value="6">6</option>
          <option value="7">7</option><option value="8">8</option>
          <option value="9">9</option><option value="10">10 (En Zor)</option>
        </select>
      </label>

      <!-- Yeni: başlıklar kendi içeriklerine ortalı, iki sütun -->
      <div class="sayilar-ve-hedef">
        <div class="sutun">
          <div id="sayilarBaslik" class="sutun-baslik">Verilen Sayılar:</div>
          <div id="sayilarAlani"></div>
        </div>
        <div class="sutun">
          <div id="hedefBaslik" class="sutun-baslik">Hedef:</div>
          <div id="hedefSayi"></div>
        </div>
      </div>

      <button class="btn" onclick="uretimYap()">🔢 Sayıları Üret 🔢</button>
      <button class="btn" onclick="gosterCozum()">🧠 Çözümü Göster 🧠</button>
      <button class="btn" onclick="puanTablosuAc()">🥇🥈🥉 Puan Tablosu 🥉🥈🥇</button>

      <!-- Çözümler burada -->
      <div id="cozumAlani"></div>

      <!-- Öğrenciler bunun altında -->
      <div class="ogrenci-listesi" id="ogrenciler"></div>
    </div>
  </div>

  <div class="footer">made by İSMAİL AKÇELİK</div>

  <!-- Puan Tablosu Modal -->
  <div id="puanTabloModal" class="modal">
    <div class="modal-content">
      <h4>🥇🥈🥉 Puan Tablosu 🥉🥈🥇</h4>
      <div class="ilk-uc-wrapper" id="ilkUc"></div>
      <table>
        <thead><tr><th>İsim</th><th>Puan</th></tr></thead>
        <tbody id="puanTabloGovde"></tbody>
      </table>
      <br>
      <button class="btn" onclick="puanTablosuKapat()">Kapat</button>
    </div>
  </div>

  <!-- Puan Modal -->
  <div id="puanModal" class="modal">
    <div class="modal-content">
      <h3 id="puanModalBaslik"></h3>
      <input type="number" id="puanInput" placeholder="Puan girin" />
      <br>
      <button class="btn" onclick="puanGir()">Kaydet</button>
      <button class="btn" onclick="modalKapat()">İptal</button>
    </div>
  </div>

  <!-- Uyarı Modal -->
  <div id="uyariModal" class="modal">
    <div class="modal-content">
      <p id="uyariMesaj" style="margin-bottom:20px; font-weight:bold;"></p>
      <button class="btn" onclick="uyariKapat()">Tamam</button>
    </div>
  </div>

  <!-- Geri Al Modal -->
  <div id="geriAlModal" class="modal">
    <div class="modal-content">
      <p style="margin-bottom:20px; font-weight:bold;">Bu turda verilen puanı geri almak üzeresiniz.</p>
      <button class="btn" onclick="puanGeriAl()">Onayla</button>
      <button class="btn" onclick="geriAlKapat()">İptal</button>
    </div>
  </div>

<script>
let ogrenciler = [];
let puanlar = {};
let aktifSayilar = [];
let hedef = 0;
let cozumAdimlari = [];
let seciliOgrenci = null;
let aktifIslemler = [];
let erkenBitir = false;
let sonVerilenPuan = {};
let timerInterval;
let kalanSure = 0;
let secilenDakika = 5; // varsayılan 5 dk

const renkler = ["#f0f8ff","#e8f5e9","#fffde7","#fce4ec","#f3e5f5","#ede7f6","#e0f7fa","#f1f8e9","#fbe9e7"];

function uyariGoster(mesaj) {
  document.getElementById("uyariMesaj").innerText = mesaj;
  document.getElementById("uyariModal").style.display = "flex";
}
function uyariKapat() { document.getElementById("uyariModal").style.display = "none"; }
function modalKapat() { document.getElementById("puanModal").style.display = "none"; }
function geriAlKapat() { document.getElementById("geriAlModal").style.display = "none"; }

function basla() {
  const metin = document.getElementById("ogrenciTextarea").value.trim();
  if (!metin) {
    uyariGoster("Lütfen önce öğrenci isimlerini yazınız.");
    return;
  }
  ogrenciler = metin.split("\n").map(i => i.trim()).filter(i => i);
  puanlar = {};
  sonVerilenPuan = {};
  document.getElementById("girisEkrani").classList.add("hidden");
  document.getElementById("oyunEkrani").classList.remove("hidden");
  const ogrenciAlani = document.getElementById("ogrenciler");
  ogrenciAlani.innerHTML = "";
  ogrenciler.forEach(isim => {
    puanlar[isim] = 0;
    sonVerilenPuan[isim] = 0;
    const div = document.createElement("div");
    div.className = "ogrenci";
    div.textContent = isim;
    div.onclick = function () {
      if (div.classList.contains("puan-verildi")) {
        seciliOgrenci = isim;
        document.getElementById("geriAlModal").style.display = "flex";
      } else {
        seciliOgrenci = isim;
        document.getElementById("puanModalBaslik").innerText = `${isim} için puan gir:`;
        document.getElementById("puanInput").value = "";
        document.getElementById("puanModal").style.display = "flex";
        setTimeout(() => document.getElementById("puanInput").focus(), 100);
      }
    };
    ogrenciAlani.appendChild(div);
  });
  guncellePuanTablosu();
}

function puanGir() {
  const deger = parseInt(document.getElementById("puanInput").value);
  if (!isNaN(deger)) {
    puanlar[seciliOgrenci] += deger;
    sonVerilenPuan[seciliOgrenci] = deger;
    const ogrenciKutusu = [...document.getElementsByClassName("ogrenci")]
      .find(div => div.textContent === seciliOgrenci);
    if (ogrenciKutusu) ogrenciKutusu.classList.add("puan-verildi");
    guncellePuanTablosu();
  }
  modalKapat();
}

function puanGeriAl() {
  if (seciliOgrenci && sonVerilenPuan[seciliOgrenci] > 0) {
    puanlar[seciliOgrenci] = Math.max(0, puanlar[seciliOgrenci] - sonVerilenPuan[seciliOgrenci]);
    sonVerilenPuan[seciliOgrenci] = 0;
    const ogrenciKutusu = [...document.getElementsByClassName("ogrenci")]
      .find(div => div.textContent === seciliOgrenci);
    if (ogrenciKutusu) ogrenciKutusu.classList.remove("puan-verildi");
    guncellePuanTablosu();
  }
  geriAlKapat();
}

document.addEventListener("keydown", function(e) {
  if (document.getElementById("puanModal").style.display === "flex") {
    if (e.key === "Enter") puanGir();
    if (e.key === "Escape") modalKapat();
  }
  if (document.getElementById("uyariModal").style.display === "flex") {
    if (e.key === "Enter" || e.key === "Escape") uyariKapat();
  }
  if (document.getElementById("geriAlModal").style.display === "flex") {
    if (e.key === "Enter") puanGeriAl();
    if (e.key === "Escape") geriAlKapat();
  }
});

function uretimYap() {
  // her turda "puan-verildi" işaretlerini temizle
  document.querySelectorAll(".ogrenci").forEach(div => div.classList.remove("puan-verildi"));
  startTimer(); // sayı üretilince sayaç başlasın

  const seviye = parseInt(document.getElementById("seviyeSec").value);
  if (seviye <= 2) aktifIslemler = ['+','-'];
  else if (seviye <= 6) aktifIslemler = ['+','-','*'];
  else aktifIslemler = ['+','-','*','/'];
  erkenBitir = (seviye <= 5);

  let cozum = null;
  while (!cozum) {
    const sayilar = [];
    let ikiBasamakli = 0;
    for (let i = 0; i < 5; i++) {
      let s;
      if (ikiBasamakli < 2 && Math.random() < 0.3) {
        s = Math.floor(Math.random() * 90) + 10;
        ikiBasamakli++;
      } else {
        s = Math.floor(Math.random() * 9) + 1;
      }
      sayilar.push(s);
    }

    if (seviye <= 2) {
      const [a, b] = sayilar.slice(0, 2);
      if (Math.random() < 0.5) {
        hedef = a + b;
        cozumAdimlari = [`${a} + ${b} = ${hedef}`];
      } else {
        const big = Math.max(a, b), small = Math.min(a, b);
        hedef = big - small;
        cozumAdimlari = [`${big} - ${small} = ${hedef}`];
      }
      cozum = true;
    } else if (seviye <= 6) {
      hedef = sayilar.slice(0,3).reduce((x,y)=>x+y);
    } else {
      hedef = Math.floor(Math.random() * 500) + 500;
    }

    aktifSayilar = sayilar;

    if (seviye > 2) {
      cozumAdimlari = [];
      const perm = permute(sayilar);
      for (let p of perm) {
        const sonuc = hesapla(p, 0, p[0], `${p[0]}`, seviye);
        if (sonuc) { cozum = sonuc; break; }
      }
    }
  }

  // 🔸 Metinleri artık kutuların içine gömmüyoruz; başlıklar ayrı
  document.getElementById("sayilarAlani").innerHTML =
    aktifSayilar.map(s => `<span class='box'>${s}</span>`).join('');
  document.getElementById("hedefSayi").innerHTML =
    `<span class='hedef-box'>${hedef}</span>`;

  document.getElementById("cozumAlani").innerHTML = "";
  document.body.style.backgroundColor = renkler[Math.floor(Math.random()*renkler.length)];
}

function gosterCozum() {
  if (aktifSayilar.length === 0) {
    uyariGoster("Lütfen önce sayıları üretiniz.");
    return;
  }
  const cozumAlani = document.getElementById("cozumAlani");
  cozumAlani.innerHTML = cozumAdimlari
    .map(adim => `<div class="step-box">${adim}</div>`).join('');
}

function hesapla(sayilar, i, toplam, yol, seviye) {
  if (erkenBitir && toplam === hedef) return yol;
  if (i === sayilar.length - 1) {
    if (toplam === hedef) return yol;
    return null;
  }
  for (let op of aktifIslemler) {
  let yeniToplam;
  if (op === '/' && toplam % sayilar[i+1] !== 0) continue;
  yeniToplam = eval(`${toplam}${op}${sayilar[i+1]}`);
  if (yeniToplam < 0) continue; // ❌ negatif sonuçları atla
    const gosterOp = op === '*' ? 'x' : op === '/' ? '÷' : op;
    const adim = `${toplam} ${gosterOp} ${sayilar[i+1]} = ${yeniToplam}`;
    cozumAdimlari.push(adim);
    const sonuc = hesapla(sayilar, i+1, yeniToplam, yol, seviye);
    if (sonuc) return sonuc;
    cozumAdimlari.pop();
  }
  return null;
}

function permute(arr) {
  if (arr.length <= 1) return [arr];
  let result = [];
  for (let i = 0; i < arr.length; i++) {
    const rest = [...arr.slice(0, i), ...arr.slice(i + 1)];
    const perms = permute(rest);
    for (let perm of perms) {
      result.push([arr[i], ...perm]);
    }
  }
  return result;
}

function guncellePuanTablosu() {
  const govde = document.getElementById("puanTabloGovde");
  const ilkUcDiv = document.getElementById("ilkUc");
  if (!govde || !ilkUcDiv) return;
  govde.innerHTML = "";
  ilkUcDiv.innerHTML = "";
  const sirali = Object.entries(puanlar).sort((a, b) => b[1] - a[1]);
  if (sirali.length === 0) return;
  const uniqueScores = [...new Set(sirali.map(e => e[1]))];
  const ilkUcPuanlar = uniqueScores.slice(0, 3);
  ilkUcPuanlar.forEach((puan, index) => {
    const div = document.createElement("div");
    div.className = `ilk-uc-kutu ilk-${index + 1}`;
    const madalya = ["🥇", "🥈", "🥉"][index] || "";
    const isimler = sirali.filter(e => e[1] === puan).map(e => e[0]);
    div.innerHTML = `${madalya}<br>${isimler.join("<br>")}<br><span style='font-size:13px;'>${puan} puan</span>`;
    ilkUcDiv.appendChild(div);
  });
  sirali.forEach(([isim, puan]) => {
    if (!ilkUcPuanlar.includes(puan)) {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${isim}</td><td>${puan}</td>`;
      govde.appendChild(tr);
    }
  });
}

function puanTablosuAc() { document.getElementById("puanTabloModal").style.display = "flex"; }
function puanTablosuKapat() { document.getElementById("puanTabloModal").style.display = "none"; }

// dışarı tıklayınca modal kapanır
window.addEventListener("click", function(e) {
  const modal = document.getElementById("puanTabloModal");
  if (e.target === modal) {
    puanTablosuKapat();
  }
});
function setTimer(minute) {
  secilenDakika = minute;
  // aktif butonu vurgula
  document.querySelectorAll(".time-btn").forEach(btn => {
    btn.classList.toggle("active", btn.textContent == minute);
  });
}

function startTimer() {
  clearInterval(timerInterval);
  kalanSure = secilenDakika * 60;
  updateTimerDisplay();

  timerInterval = setInterval(() => {
    kalanSure--;
    updateTimerDisplay();
    if (kalanSure <= 0) {
      clearInterval(timerInterval);
      const t = document.getElementById("timer");
      t.textContent = "⏱ Süre Bitti!";
      t.classList.add("timeout");
    }
  }, 1000);
}

function updateTimerDisplay() {
  const t = document.getElementById("timer");
  const min = String(Math.floor(kalanSure / 60)).padStart(2, '0');
  const sec = String(kalanSure % 60).padStart(2, '0');
  t.textContent = `⏱ ${min}:${sec}`;
  t.classList.remove("timeout");
}
</script>
</body>
</html>
